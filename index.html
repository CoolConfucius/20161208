<html>
<head>
  <title></title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.0/angular.min.js"></script>
  <script type='text/javascript'>
// Create a module
var myAppModule = angular.module('myApp', []);
// Create a factory (attached to this module)
myAppModule.factory('productFactory', function (){
    // The factory is nothing more than a function that returns an object
    var products = [
        {name: 'Mike', price: 34},
        {name: 'John', price: 24},
        {name: 'Trey', price: 24}];
    var factory = {};
    // Add a getProducts key to the factory object with a value of a function.
    factory.getProducts = function (callback){
        // Pass the products to a callback to be used by whoever calls the method
        callback(products);
    }
    // Most important step: return the object so it can be used by the rest of our angular code

    factory.addProduct = function(callback){
      products.push(callback()); 
    }

    factory.deleteProduct = function(callback){
      products.splice(callback(), 1); 
    }

    factory.log = function(callback){
      console.log("factory log", products);
      callback(products); 
    }



    return factory;
});


// Create a controller (attached to this module), and inject the productFactory in it.
myAppModule.controller('studentsController', ['$scope', 'productFactory', function ($scope, productFactory){
    //  initialize an empty array so $scope.products maintains a consistent data type
    $scope.products = [];
    // run the getProducts method and set $scope data in the callback
    productFactory.getProducts(function (data){
        $scope.products = data;
    })

    function newproduct(){
      $scope.newproduct = {
        firstname: "",
        lastname: "", 
        favoritelanguage: ""
      };
    }
    newproduct(); 
    $scope.addproduct = function(){
      // $scope.products.push($scope.newproduct);
      productFactory.addProduct(function(){
        return $scope.newproduct; 
      })
      newproduct();
    }
    $scope.deleteproduct = function(index){
      console.log(index);
      // $scope.products.splice(index, 1); 
      productFactory.deleteProduct(function(data){
        return index; 
      })
    }

    $scope.log = function(){
      console.log();
      productFactory.log(function(data){
        console.log('controller log: ', data);
      })
    }

}])
  </script>
</head>
<body ng-app='myApp'>
    <div ng-controller = "studentsController">      
      <button ng-click="log()">Log Products</button><br>
      Product Name: <input type="text" ng-model="newproduct.name"><br>
      Product Price: <input type="number" ng-model="newproduct.price">
      <button ng-click="addproduct()">Add Product</button>
      <table>
        <thead>
          <th>#</th>
          <th>Name</th>
          <th>Price</th>
          <th>Action</th>
        </thead>
        <tbody>
          <tr ng-repeat="product in products track by $index">
            <td>{{$index}}</td>
            <td>{{product.name}}</td>
            <td>{{product.price}}</td>
            <td><button ng-click="deleteproduct($index)">Delete Product</button></td>
          </tr>
        </tbody>
      </table>
    </div>
</body>
</html>